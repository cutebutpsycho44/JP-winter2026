<script>
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsNmpYBJTnOp4Wa3lQy3VeTolxfSHKzRaXXGnM2k_C8iq0hYC4MlLLqSIb12Ml8fDDw6AhPp6ePFds/pub?gid=289892197&single=true&output=csv";

        let allData = [];

        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
        });

        function fetchData() {
            const loading = document.getElementById('loading');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ß‡∏¥ ‡πÉ‡∏´‡πâ‡∏ü‡πâ‡∏≠‡∏á
            const timer = setTimeout(() => {
                if(loading.innerHTML.includes('Loading')) {
                    loading.innerHTML = `
                        <div class="text-red-500 font-bold">‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</div>
                        <div class="text-sm mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏á‡∏Å‡πå Google Sheet</div>
                        <button onclick="location.reload()" class="mt-4 bg-gray-200 px-4 py-2 rounded-full text-sm">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    `;
                }
            }, 8000);

            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    clearTimeout(timer);
                    console.log("Data loaded:", results.data); // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô Console
                    
                    if (results.data.length === 0) {
                        loading.innerHTML = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV (‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)";
                        return;
                    }

                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Day ‡πÑ‡∏´‡∏°
                    const firstRow = results.data[0];
                    if (!firstRow.hasOwnProperty('Day')) {
                        loading.innerHTML = `
                            <div class="text-red-500 font-bold">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "Day"</div>
                            <div class="text-sm mt-2 text-left bg-gray-100 p-4 rounded-lg overflow-auto">
                                <p>‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏∑‡∏≠:</p>
                                <code class="text-xs text-blue-600">${Object.keys(firstRow).join(', ')}</code>
                                <p class="mt-2">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô Sheet ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô <b>Day</b> (‡∏ï‡∏±‡∏ß D ‡πÉ‡∏´‡∏ç‡πà)</p>
                            </div>
                        `;
                        return;
                    }

                    allData = results.data;
                    renderDaysGrid(allData);
                },
                error: function(err) {
                    clearTimeout(timer);
                    console.error("Error:", err);
                    loading.innerHTML = `
                        <div class="text-red-500 font-bold">‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>
                        <div class="text-xs mt-2 text-gray-400">${err.message}</div>
                    `;
                }
            });
        }

        function getDayEmoji(dayText) {
            if (!dayText) return 'üìÖ';
            const d = dayText.toLowerCase().replace(/\s/g, ''); 
            if (d.includes('day1')) return '‚úàÔ∏è'; 
            if (d.includes('day2')) return 'üóª'; 
            if (d.includes('day3') || d.includes('day4') || d.includes('day5')) return 'üèÇ'; 
            if (d.includes('day6')) return 'üêª'; 
            if (d.includes('day7')) return 'üåã'; 
            if (d.includes('day8')) return '‚úàÔ∏è'; 
            return 'üáØüáµ'; 
        }

        // --- View 1: Landing Page ---
        function renderDaysGrid(data) {
            const grid = document.getElementById('days-grid');
            const loading = document.getElementById('loading');
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Loading ‡πÅ‡∏•‡∏∞ Grid
            loading.classList.add('hidden');
            grid.innerHTML = '';

            const daysMap = new Map();
            let hasData = false;

            data.forEach(row => {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ row.Day ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÑ‡∏´‡∏° (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà null ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ß‡πà‡∏≤‡∏á)
                if(!row.Day || row.Day.trim() === '') return;
                
                hasData = true;
                if(!daysMap.has(row.Day)) {
                    daysMap.set(row.Day, { date: row.Date || '', dayTitle: row.Day });
                }
            });

            if (!hasData) {
                loading.classList.remove('hidden');
                loading.innerHTML = "‚ùå ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 'Day'<br>‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß‡∏ß‡πà‡∏≤‡∏á‡πÜ ‡∏Ñ‡∏±‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö";
                return;
            }

            daysMap.forEach((val, key) => {
                const emoji = getDayEmoji(val.dayTitle);
                const card = document.createElement('div');
                
                card.className = "bg-white p-6 rounded-3xl shadow-sm border-2 border-transparent hover:border-blue-100 cursor-pointer transition-all active:scale-95 flex items-center justify-between group";
                card.onclick = () => showTimeline(key);

                card.innerHTML = `
                    <div class="text-left">
                        <p class="text-gray-400 text-xs font-bold tracking-[0.2em] uppercase mb-2">${val.date}</p> 
                        <h2 class="shimmer-text text-4xl font-bold tracking-tight">${val.dayTitle}</h2>
                    </div>
                    <div class="text-5xl opacity-80 group-hover:scale-110 transition-transform filter drop-shadow-sm">
                        ${emoji}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- View 2: Timeline ---
        function showTimeline(selectedDay) {
            document.getElementById('landing-view').classList.add('hidden');
            document.getElementById('detail-view').classList.remove('hidden');
            window.scrollTo(0, 0);

            const container = document.getElementById('timeline-content');
            container.innerHTML = '';

            const dayData = allData.filter(row => row.Day === selectedDay);
            
            if(dayData.length > 0) {
                document.getElementById('detail-title').innerText = `${selectedDay}`;
            }

            dayData.forEach(row => {
                // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Time ‡∏´‡∏£‡∏∑‡∏≠ Activity ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á
                if ((!row.Activity || row.Activity.trim() === '') && (!row.Time || row.Time.trim() === '')) return;

                const item = document.createElement('div');
                item.className = "relative flex items-start gap-4 z-10";

                const catStyle = getCategoryStyle(row.Category);
                const categoryIcon = getCategoryIcon(row.Category);

                item.innerHTML = `
                    <div class="flex-shrink-0 w-14 h-14 rounded-2xl flex items-center justify-center border-2 shadow-sm text-2xl bg-white z-10 ${catStyle.border} ${catStyle.bg}">
                        ${categoryIcon}
                    </div>
                    <div class="flex-1 bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                        
                        <div class="text-2xl sm:text-3xl font-bold text-accent-blue mb-2 tracking-tight">
                            ${row.Time || ''}
                        </div>
                        
                        ${row.Location ? `
                        <div class="mb-3">
                             <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(row.Location)}" target="_blank" class="text-lg sm:text-xl font-semibold text-gray-800 hover:text-blue-600 underline decoration-2 decoration-blue-200 underline-offset-4 transition-colors break-words text-balance leading-snug block">
                                üìç ${row.Location}
                             </a>
                        </div>
                        ` : ''}
                        
                        <div class="text-gray-500 text-base font-medium leading-relaxed break-words text-balance mb-4">
                            ${row.Activity || '-'}
                        </div>
                        
                        ${(row.Departure || row.Arrival) ? `
                            <div class="flex flex-wrap gap-x-4 gap-y-2 mt-3 pt-3 border-t border-gray-100 text-sm text-gray-600 bg-gray-50/50 p-2 rounded-lg">
                                ${row.Departure ? `<div>Dep: <span class="font-bold text-accent-blue">${row.Departure}</span></div>` : ''}
                                ${row.Arrival ? `<div>Arr: <span class="font-bold text-accent-blue">${row.Arrival}</span></div>` : ''}
                            </div>
                        ` : ''}
                        
                        ${row['Map Code'] ? `
                            <div class="mt-3 text-sm text-gray-400 font-normal border-t border-dashed border-gray-200 pt-2">
                                Map Code: <span class="${catStyle.text} font-medium tracking-wider ml-1">${row['Map Code']}</span>
                            </div>
                        ` : ''}
                        
                        ${row.Category ? `
                            <div class="mt-4 flex justify-end">
                                <span class="text-xs font-bold px-3 py-1 rounded-lg uppercase tracking-wider border ${catStyle.bg} ${catStyle.border} ${catStyle.text}">
                                    ${row.Category.toUpperCase()}
                                </span>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function showLanding() {
            document.getElementById('detail-view').classList.add('hidden');
            document.getElementById('landing-view').classList.remove('hidden');
        }

        // Helpers
        function getCategoryStyle(cat) {
            if (!cat) return { bg: 'bg-gray-100', border: 'border-gray-200', text: 'text-gray-500' };
            const c = cat.toUpperCase().trim();
            if (c === 'FOOD') return { bg: 'bg-purple-200', border: 'border-purple-300', text: 'text-purple-800' };
            if (c === 'TRAVEL') return { bg: 'bg-pink-200', border: 'border-yellow-500', text: 'text-pink-800' };
            if (c === 'SHOPPING') return { bg: 'bg-red-200', border: 'border-red-300', text: 'text-red-900' };
            if (c === 'SNOW') return { bg: 'bg-sky-200', border: 'border-blue-800', text: 'text-blue-900' };
            if (c === 'HOTEL') return { bg: 'bg-yellow-200', border: 'border-yellow-500', text: 'text-yellow-900' };
            if (c.includes('COFFEE') || c.includes('MATCHA')) return { bg: 'bg-green-200', border: 'border-amber-800', text: 'text-green-900' };
            return { bg: 'bg-gray-100', border: 'border-gray-300', text: 'text-gray-600' };
        }

        function getCategoryIcon(cat) {
            if (!cat) return '‚ú®';
            const c = cat.toUpperCase();
            if (c === 'FOOD') return 'üçú';
            if (c === 'TRAVEL') return 'üöÑ';
            if (c === 'SHOPPING') return 'üõçÔ∏è';
            if (c === 'SNOW') return 'üèÇ'; 
            if (c === 'HOTEL') return 'üè®';
            if (c.includes('COFFEE') || c.includes('MATCHA')) return 'üçµ';
            return 'üìå';
        }
    </script>
